
<html>
<head>
    <title>F&O Ticker Analyzer</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        .gain { color: green; font-weight: bold; }
        .loss { color: red; font-weight: bold; }
        body { padding: 30px; font-family: Arial; }
    </style>
</head>
<body>
    <h2>F&O Price Movement</h2>
    <button id="analyzeBtn" class="btn btn-primary">Analyze</button>
    <div id="result" style="margin-top: 30px;"></div>

    <script>
        document.getElementById("analyzeBtn").onclick = function() {
            document.getElementById("analyzeBtn").innerText = "Analyzing...";
            fetch('/analyze')
                .then(res => res.json())
                .then(data => {
                    const rows = data.map(row => `
                        <tr>
                            <td>${row.ticker}</td>
                            <td>${row.morning_date}</td>
                            <td>${row.p915 ?? 'NA'}</td>
                            <td>${row.p919 ?? 'NA'}</td>
                            <td class="${row.morning_change == null ? '' : row.morning_change >= 0 ? 'gain' : 'loss'}">
                                ${row.morning_change != null ? row.morning_change + '%' : 'NA'}
                            </td>
                            <td>${row.closing_date}</td>
                            <td>${row.p315 ?? 'NA'}</td>
                            <td>${row.p329 ?? 'NA'}</td>
                            <td class="${row.closing_change == null ? '' : row.closing_change >= 0 ? 'gain' : 'loss'}">
                                ${row.closing_change != null ? row.closing_change + '%' : 'NA'}
                            </td>
                        </tr>
                    `).join('');

                    document.getElementById("result").innerHTML = `
                        <table class="table table-bordered table-striped table-hover table-sm">
                            <thead class="table-dark">
                                <tr>
                                    <th>Ticker</th>
                                    <th>Morning Date</th>
                                    <th>9:15 AM</th>
                                    <th>9:19 AM</th>
                                    <th>% Change</th>
                                    <th>Closing Date</th>
                                    <th>3:15 PM</th>
                                    <th>3:29 PM</th>
                                    <th>% Change</th>
                                </tr>
                            </thead>
                            <tbody>${rows}</tbody>
                        </table>`;
                    document.getElementById("analyzeBtn").innerText = "Analyze";
                })
                .catch(err => {
                    alert("Error fetching data");
                    document.getElementById("analyzeBtn").innerText = "Analyze";
                });
        };
    </script>
</body>
</html>